{"version":3,"file":"app/javascripts/build/classes.js","sources":["app/javascripts/build/classes.js","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/4"],"names":[],"mappings":"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","sourcesContent":["\n/////////////////////\n/// Appliction Delegate\n/////////////////////\n\nclass Application {\n\n  constructor() {\n    this.startSoundCloud();\n    this.setStructure();\n  }\n\n  startSoundCloud() {\n    this.SoundCloud = new SoundCloud();\n    this.SoundCloud.connect({\n      success: _.bind(function(userId) {\n        this.getInitialCollection();\n      }, this)\n    });\n  }\n\n  getInitialCollection() {\n    this.favorites  = new FavoritesCollection({userId: this.SoundCloud.userId});\n\n    this.favorites.fetch({\n      success: _.bind(function(collection) {\n        this.SoundCloud.favorites = collection;\n        this.startBackbone();\n        this.SoundCloud.setupVolume();\n      }, this)\n    });\n  }\n\n  startBackbone() {\n    this.Router = new Router();\n    Backbone.history.start();\n  }\n\n  setStructure() {\n    this.Views = {};\n  }\n\n}\n\n/////////////////////\n/// Start the app\n/////////////////////\n\n$(() => {\n  window.App = new Application();\n});;\n/////////////////////\n/// Backbone Router\n/////////////////////\n\nclass Router extends Backbone.Router {\n\n  constructor() {\n    this.routes = {\n      ''    : 'player'\n    }\n    super();\n  }\n\n  player() {\n    new PlayerView();\n  }\n\n};\n/////////////////////\n/// Soundcloud & audio management\n/////////////////////\n\nclass SoundCloud {\n\n  constructor() {\n    this.clientId = Config.clientId;\n    this.initialize();\n    this.favorites = [];\n    this.setupAudio();\n  }\n\n  /////////////////////\n  /// App setup\n  /////////////////////\n\n  initialize() {\n    SC.initialize({\n      client_id: this.clientId,\n      redirect_uri: Config.redirectUri\n    });\n  }\n\n  setupAudio() {\n    // Not using React for this\n    this.audioElement = document.getElementById('current-track');\n    this.audioElement.addEventListener('timeupdate', _.throttle(function() {\n      App.SoundCloud.getWaveform().redraw();\n    }, 350), false);\n    this.audioContext = new webkitAudioContext();\n    this.audioSource  = this.audioContext.createMediaElementSource(this.audioElement);\n    this.audioSource.connect(this.audioContext.destination);\n  }\n\n  setupVolume() {\n    var volume = readCookie('volume') || 1;\n    document.cookie = `volume=${volume}`\n\n    this.volumeSlider = new Dragdealer('volume-slider', {\n      x: volume,\n      animationCallback: _.bind(function(x, y) {\n        this.currentTrack && this.setVolume(x);\n      }, this)\n    });\n  }\n\n  /////////////////////\n  /// Get user data\n  /////////////////////\n\n  connect(options) {\n\n    var self   = this,\n        userId = readCookie('userId'),\n        success = options.success;\n\n    // If the userId is null\n    if (!userId) {\n\n      // Make the user login\n      SC.connect(function() {\n        SC.get('/me', function(me) {\n          self.userId = me.id;\n          self.publicFavoritesCount = me.public_favorites_count;\n\n          document.cookie = `userId=${me.id}`\n          document.cookie = `publicFavoritesCount=${me.public_favorites_count}`\n          document.cookie = `avatarUrl=${me.avatar_url}`\n          document.cookie = `username=${me.username}`\n\n          success(userId);\n        });\n      });\n\n    } else {\n\n      // Save the userId\n      this.userId = userId;\n      success(userId);\n\n    }\n  }\n\n  /////////////////////\n  /// Streaming\n  /////////////////////\n\n  setVolume(number) {\n    number = number || readCookie('volume');\n\n    // number = parseFloat(number);\n    number = Math.round(number * 100);\n    if (number < 5) { number = 0; }\n    this.currentTrack.volume = number / 100;\n    document.cookie = `volume=${number / 100}`\n  }\n\n  playTrack(track) {\n    var url = `${track.stream_url}?client_id=${this.clientId}`;\n    \n    // Handle the current song\n    this.currentTrack && this.pauseCurrentTrack() && this.clearCurrentTrack();\n\n    // Template the now playing view\n    App.Views.NowPlayingView.render(track);\n\n    // Change the source of the audio element and play the new track\n    this.audioElement.src = url;\n    this.currentTrack = this.audioSource.mediaElement;\n    this.setVolume();\n    this.currentTrack.play();\n    this.getWaveform().dataFromSoundCloudTrack(track);\n  }\n\n  clearCurrentTrack() {\n    this.audioElement.currentTime = 0;\n    this.audioElement.duration = 1;\n  }\n\n  pauseCurrentTrack() {\n    this.currentTrack.pause();\n  }\n\n  playCurrentTrack() {\n    this.currentTrack.play();\n  }\n\n  /////////////////////\n  /// Comments\n  /////////////////////\n\n  fetchComments(trackId) {\n    // Fetch the comments for the track\n    SC.get(`/tracks/${trackId}/comments`, function(comments) {\n      // TODO: Boo jQuery\n      $('#comments-wrap').scrollTop(0)\n      React.renderComponent(\n        Comments({data: comments}),\n        document.getElementById('comments-wrap')\n      )\n    });\n  }\n\n  /////////////////////\n  /// Waveform\n  /////////////////////\n\n  getWaveform() {\n    if (!this.waveform) {\n      var container = document.getElementById('waveform'),\n          width     = container.getBoundingClientRect().width - 300; // Subtract 300 as the sidebar is that wide and this element is positioned with 100% window width but with padding on the left.\n\n      this.createWaveform(container, width);\n      this.createGradient();\n      this.watchWaveformClickEvents();\n    }\n\n    return this.waveform;\n  }\n\n  createWaveform(container, width) {\n    this.waveform = new Waveform({\n      container: container,\n      width: width,\n      innerColor: _.bind(function(percentageOfWaveform, d) {\n        var songPercentage = this.audioElement.currentTime / this.audioElement.duration;\n\n        if (percentageOfWaveform > songPercentage || isNaN(percentageOfWaveform) === true || isNaN(this.audioElement.duration) || typeof(percentageOfWaveform) === 'undefined') {\n          // If this portion of the track hasn't played yet\n          return '#444';\n        } else {\n          // If this portion of the track has already played\n          return this.gradient;\n        }\n      }, this)\n    });\n\n    this.waveformCanvas = document.querySelectorAll('#waveform canvas')[0];\n  }\n\n  createGradient() {\n    var waveformContext = this.waveform.context,\n        gradient = waveformContext.createLinearGradient(0, 0, 0, this.waveform.height);\n\n    gradient.addColorStop(0.0, \"#f60\");\n    gradient.addColorStop(1.0, \"#ff1b00\");\n    this.gradient = gradient;\n  }\n\n  // Change the track position upon click\n  watchWaveformClickEvents() {\n    this.waveformCanvas.addEventListener('click', _.bind(function(event) {\n      var mousePos = this.getMousePosition(this.waveformCanvas, event),\n          percentage = mousePos.x / mousePos.width,\n          seekTo = this.audioElement.duration * percentage;\n\n      this.audioElement.currentTime = seekTo;\n    }, this), false);\n  }\n\n  // Get the mouse position over the canvas\n  getMousePosition(canvas, event) {\n    var rect = canvas.getBoundingClientRect();\n    return {\n      x: event.clientX - rect.left,\n      y: event.clientY - rect.top,\n      width: rect.width\n    };\n  }\n\n}","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2)","$traceurRuntime.superCall($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                   $__placeholder__3)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)"]}